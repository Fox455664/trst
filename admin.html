<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© - Ø§Ù„Ù…Ø´Ø±Ù</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main-blue: #005a8f; --main-orange: #f28b00; --bg: #f3f4f6; --text: #1f2937; --danger: #ef4444; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; outline: none; }
        body { background: var(--bg); color: var(--text); padding-bottom: 60px; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { background: white; padding: 15px 20px; border-bottom: 4px solid var(--main-orange); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .logo-box { display: flex; align-items: center; gap: 10px; }
        .logo-box img { height: 50px; }
        
        /* Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¯Ù…Ø¬ (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯) */
        .dept-badge { 
            border: 2px solid var(--main-blue); 
            color: var(--main-blue); 
            padding: 8px 15px; 
            border-radius: 10px; 
            font-weight: bold; 
            font-size: 12px; 
            text-align: center; 
            background: #f0f9ff; 
            line-height: 1.6;
        }
        
        .btn-logout { background: #fee2e2; color: #dc2626; border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 13px; }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .nav-tabs { display: flex; gap: 10px; padding: 20px; max-width: 800px; margin: auto; }
        .tab-btn { flex: 1; padding: 14px; border: none; border-radius: 12px; background: white; color: #6b7280; font-weight: bold; font-size: 15px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab-btn.active { background: var(--main-blue); color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,90,143,0.2); }

        .container { max-width: 800px; margin: 0 auto; padding: 0 15px; }
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #e5e7eb; position: relative; overflow: hidden; }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯) */
        .violations-box { 
            background: #fff5f5; 
            border: 1px solid #feb2b2; 
            border-radius: 10px; 
            padding: 15px; 
            margin: 15px 0; 
        }
        .v-title { color: #991b1b; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; font-size: 14px; }
        .v-item { background: white; padding: 10px; border-radius: 8px; border: 1px solid #fed7aa; margin-bottom: 8px; }
        .v-note { font-size: 13px; color: #333; margin-top: 5px; background: #fffbeb; padding: 5px; border-radius: 5px; border-right: 3px solid var(--main-orange); }
        .v-img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; margin-top: 5px; cursor: pointer; border: 2px solid #eee; }

        /* ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ø±Øª */
        .r-serial { font-weight: 800; font-size: 18px; color: #111; }
        .r-meta { font-size: 12px; color: #6b7280; }
        .data-row { font-size: 14px; margin-bottom: 6px; color: #4b5563; display: flex; align-items: center; gap: 6px; }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© */
        #imgModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; }
        #imgModal img { max-width: 95%; max-height: 80vh; border-radius: 8px; }
        .close-modal { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .eye-btn { width: 100%; background: #f0f9ff; color: var(--main-blue); border: 1px solid #bae6fd; padding: 10px; margin-top: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .details-panel { display: none; background: #fafafa; padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid #eee; }
        .ans-row { display: flex; justify-content: space-between; align-items: flex-start; padding: 8px; border-bottom: 1px solid #eee; font-size: 13px; gap: 10px; }
        .q-val { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; min-width: 65px; text-align: center; }
        .val-yes { background: #dcfce7; color: #166534; }
        .val-no { background: #fee2e2; color: #991b1b; }
        
        .input-group { margin-bottom: 15px; }
        .custom-input { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 10px; background: white; }
        .btn-save { width: 100%; background: var(--main-blue); color: white; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ† */
        .inspector-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: white; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<!-- Ù†Ø§ÙØ°Ø© ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© -->
<div id="imgModal" onclick="this.style.display='none'">
    <span class="close-modal">&times;</span>
    <img id="modalImg" src="">
</div>

<div class="header">
    <div class="logo-box">
        <img src="imeg/imge.jpg" alt="Logo">
        <div>
            <div style="font-weight:bold; color:var(--main-blue); font-size:15px;">Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨Ø©</div>
            <div style="font-size:11px; color:var(--main-orange);">Ø¥Ø¯Ø§Ø±Ø© Ø¶ÙˆØ§Ø­ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</div>
        </div>
    </div>
    <!-- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¯Ù…Ø¬ Ø§Ù„Ù†ØµÙŠÙ† ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ ÙˆØ§Ø­Ø¯ -->
    <div class="dept-badge">
        Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©<br>
        Ø¥Ø¯Ø§Ø±Ø© Ø¶ÙˆØ§Ø­ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶
    </div>
    <button class="btn-logout" onclick="logout()"><i class="fa-solid fa-power-off"></i> Ø®Ø±ÙˆØ¬</button>
</div>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab('reports', this)"><i class="fa-regular fa-file-lines"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
    <button class="tab-btn" onclick="switchTab('inspectors', this)"><i class="fa-solid fa-users-gear"></i> Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</button>
</div>

<div class="container">

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
    <div id="reports" class="section active">
        <div style="position:relative; margin-bottom:20px;">
            <i class="fa-solid fa-magnifying-glass" style="position:absolute; right:15px; top:12px; color:#999"></i>
            <input type="text" id="searchRep" class="custom-input" style="padding-right:40px" placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŒ Ø§Ù„Ù…ÙØªØ´..." onkeyup="renderReports()">
        </div>
        <div id="reportsList">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…ÙØªØ´ÙŠÙ† -->
    <div id="inspectors" class="section">
        <div class="card">
            <h3 style="color:var(--main-blue); margin-bottom:15px">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ´ Ø¬Ø¯ÙŠØ¯</h3>
            <div class="input-group"><input id="newInspectorName" class="custom-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´"></div>
            <div class="input-group"><input id="newInspectorPass" class="custom-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±"></div>
            <button class="btn-save" onclick="addInspector()">Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ´</button>
        </div>
        <div class="card">
            <h3 style="color:var(--main-blue); margin-bottom:15px">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</h3>
            <div id="usersListContainer"></div>
        </div>
    </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const REDIS_URL = "https://exact-parakeet-58043.upstash.io";
const REDIS_TOKEN = "AeK7AAIncDFmOTAzMGJlOTM5Y2I0ZTFjYTg4ODRhOWIyNjJmZWMwY3AxNTgwNDM";

// Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
const fullQuestionsList = [
    "ØªØµØ±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ø«Ø§Ù†ÙˆÙŠ Ù…ØªÙˆØ§Ø¬Ø¯ Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„",
    "Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ø¹Ù…Ù„ Ù…ØªÙˆØ§Ø¬Ø¯ Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„",
    "Ù†Ù…ÙˆØ°Ø¬ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ù…ØªÙˆØ§Ø¬Ø¯ Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„ (Ù…Ø°ÙƒÙˆØ± Ø±Ù‚Ù… Ø§Ù„Ù…Ù‚Ø§ÙŠØ³Ø© â€“ ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ â€“ Ø±Ù‚Ù… Ø§Ù„ØªØµØ±ÙŠØ­ â€“ ØªÙˆÙ‚ÙŠØ¹ Ù…Ø´Ø±Ù Ø§Ù„ÙƒÙ‡Ø±Ø¨ ÙˆØ§Ù„Ø´Ø±ÙƒØ©)",
    "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¢Ù…Ù† ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØªÙˆÙØ±Ù‡Ø§ Ø¨Ù„ØºØ§Øª Ù…Ù†Ø§Ø³Ø¨Ø©",
    "Ø¥Ù„Ù…Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… ÙˆÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¢Ù…Ù† ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ù…Ù‡Ù…Ø©",
    "Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
    "Ø¨Ø·Ø§Ù‚Ø© ØªØ¹Ù…ÙŠØ¯ Ø§Ù„Ù…ØµØ¯Ø± ÙˆØ§Ù„Ù…Ø³ØªÙ„Ù… ÙˆØ§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø³Ø§Ø±ÙŠØ© ÙˆØ¨ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„",
    "ØªØ£Ù‡ÙŠÙ„ Ø³Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª (Ø³Ø§Ø¦Ù‚ ÙˆÙ†Ø´ â€“ Ø³Ù„Ø© Ù‡ÙˆØ§Ø¦ÙŠØ© -........)",
    "Ø§Ù„Ù…Ø³ØªÙ„Ù… Ù…ØªÙˆØ§Ø¬Ø¯ Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„",
    "ÙˆØ¶Ø¹ Ø£Ù‚ÙØ§Ù„ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ùˆ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© Ùˆ Ø¥ÙƒØªÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„",
    "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø£Ø±Ø¶ÙŠ Ø§Ù„Ù…ØªÙ†Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¬Ù‡ØªÙŠÙ†",
    "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙØ¹Ø§Ù„ÙŠØ© Ø¬Ù‡Ø§Ø² ÙƒØ´Ù Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„ØªØ³ØªØ±",
    "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆØ§Ø¬Ø¯ Ù†Ù…ÙˆØ°Ø¬ ÙØ­Øµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ÙˆØ§Ù„Ø¹Ø¯Ø¯ ÙˆØ§Ù„Ø§Ø¯ÙˆØ§Øª Ù…ØªÙˆØ§Ø¬Ø¯ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø¹Ù ÙˆØ§Ù„Ù…ÙƒØ§ÙØ­ ÙˆÙØ­Øµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ÙˆØ§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø®Ø·Ø·",
    "Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ÙØ­Øµ",
    "Ù†Ù…ÙˆØ°Ø¬ ÙØ­Øµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©",
    "Ù†Ù…ÙˆØ°Ø¬ ÙØ­Øµ Ø§Ù„Ø¹Ø¯Ø¯ ÙˆØ§Ù„Ø§Ø¯ÙˆØ§Øª",
    "Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø¹Ù",
    "Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…ÙƒØ§ÙØ­",
    "Ø´Ù‡Ø§Ø¯Ø© tuv",
    "QR Code",
    "ÙØ­Øµ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø±ÙØ¹ Ùˆ Ø§Ù„Ø­ÙØ± Ù…Ù† Ù‚Ø¨Ù„ Ø·Ø±Ù Ø«Ø§Ù„Ø« (ØªÙ‰ ÙŠÙˆ ÙÙ‰)",
    "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø³Ù„Ø§Øª Ù„Ù„Ù…ÙˆØ§ØµÙØ§Øª ( ÙƒÙØ±Ø§Øª â€“ Ø²ÙŠÙˆØª â€“ ÙƒØ³ÙˆØ± â€“ Ø­Ø²Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† â€“ ØªÙƒØ¯Ø³ Ù…ÙˆØ§Ø¯ .. Ø§Ù„Ø®)",
    "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø³Ù„Ø§Ù…Ø© Ø®Ø·Ø§Ù Ø§Ù„ÙˆÙ†Ø´ ÙˆØ§Ø­Ø¨Ø§Ù„ Ø§Ù„Ø±ÙØ¹",
    "Ø·ÙØ§ÙŠØ© Ø­Ø±ÙŠÙ‚ Ø³Ù„ÙŠÙ…Ø© ÙˆÙ…ÙØ­ÙˆØµØ© ÙˆØ³Ù„Ø§Ù…Ø© Ø§Ø³ØªÙƒØ± Ø§Ù„ÙØ­Øµ",
    "Ø´Ù†Ø·Ø© Ø¥Ø³Ø¹Ø§ÙØ§Øª Ù…ÙƒØªÙ…Ù„Ø© ÙˆÙ…ÙØ­ÙˆØµØ©",
    "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø£Ø±Ø¶ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø§Øª",
    "Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ø­Ø¯Ø¯ Ø¨ÙˆØ¶ÙˆØ­ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø±ÙØ¹",
    "Ù…Ù‡Ø§Ù… Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø³Ù„ÙŠÙ…Ø© (Ø¨Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„ØªÙØªÙŠØ´ Ø¹Ù„ÙŠØ©) Ø®ÙˆØ°Ø© - Ù…Ù„Ø§Ø¨Ø³ â€“ Ø­Ø°Ø§Ø¡",
    "Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙØ§Ø² Ø§Ù„Ù…Ø·Ø§Ø·ÙŠ (33000 â€“ 13000 â€“ 1000) Ùƒ.Ù.Ø£",
    "Ø§Ù„Ø®ÙˆØ°Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ù…Ø²ÙˆØ¯Ø© Ø¨Ø­Ø§Ù…Ù‰ ÙˆØ¬Ø©",
    "Ø£Ø­Ø²Ù…Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ù…Ø±Ù‚Ù…Ø© ÙˆØ³Ù„ÙŠÙ…Ø©",
    "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­ÙˆØ§Ø¬Ø² Ø­Ù…Ø§ÙŠØ© Ø³Ù„ÙŠÙ…Ø© ÙˆÙƒØ§ÙÙŠØ© Ùˆ Ø´Ø±ÙŠØ· ØªØ­Ø°ÙŠØ±ÙŠ",
    "ÙƒÙØ§ÙŠØ© Ø§Ù„Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© Ø§Ù„Ù…Ø±ÙˆØ±ÙŠØ©",
    "Ø§Ù„ØªØ±Ù…ÙŠØ² Ø¨Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± Ù„Ù„Ø¹Ø¯Ø¯ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ£Ø¯ÙˆØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©",
    "ØªØ®Ø²ÙŠÙ† Ø£Ø³Ø·ÙˆØ§Ù†Ø§Øª Ø§Ù„ØºØ§Ø² ÙˆØ£Ø³Ø·ÙˆØ§Ù†Ø§Øª Ø§Ù„Ø§ÙƒØ³Ø¬ÙŠÙ† ÙˆØ§Ù„Ù„Ø­Ø§Ù… ÙˆØªØ±Ù…ÙŠØ²Ù‡Ø§",
    "ÙˆØ¬ÙˆØ¯ Ø£ØºØ·ÙŠØ© Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ø£Ø³Ø·ÙˆØ§Ù†Ø§Øª Ø§Ù„ØºØ§Ø² ÙˆØ§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†",
    "Ù„ÙŠØ§Øª Ø§Ù„Ø§ÙˆÙƒØ³ÙŠ Ø§Ø³ØªÙŠÙ„ÙŠÙ† Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ù‡Ø§ ØªØ´Ù‚Ù‚Ø§Øª Ø§Ùˆ ØªØ§Ù„ÙØ©",
    "Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù†Ø¸Ù… ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª",
    "ÙˆØ¬ÙˆØ¯ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª",
    "ØªÙ… Ø§Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ù„ÙØ§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„",
    "Ø®Ø·Ø· Ù…ØªØ¹Ù„Ù‚Ø© Ø¨ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„",
    "Ø®Ø·Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦",
    "Ø®Ø·Ø© Ø§Ù„Ù…Ù†Ø¹ Ù…Ù† Ø§Ù„Ø³Ù‚ÙˆØ·",
    "Ø®Ø·Ø© Ø§Ù„Ø¥Ù†Ù‚Ø§Ø° ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ØªÙØ¹Ø§Øª",
    "Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ø£Ø­Ù…Ø§Ù„ Ø§Ù„Ø­Ø±Ø¬Ø©",
    "Ø¥Ø¬Ø±Ø§Ø¡ ÙˆÙ…Ù„ØµÙ‚Ø§Øª Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø³Ù…Ø¹",
    "Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø±ØªÙØ¹Ø§Øª Ø§ÙˆÙ…Ù„ØµÙ‚ Ø£ØºØ±Ø§Ø¶ Ù…ØªØ³Ø§Ù‚Ø·Ø©",
    "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø®Ø·Ø§Ù Ø§Ù„ÙˆÙ†Ø´ ÙˆØ§Ø­Ø¨Ø§Ù„ Ø§Ù„Ø±ÙØ¹",
    "Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ø­Ø¯Ø¯ Ø¨ÙˆØ¶ÙˆØ­ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø±ÙØ¹",
    "Ù…Ù‡Ø§Ù… Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø³Ù„ÙŠÙ…Ø© (Ø¨Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„ØªÙØªÙŠØ´ Ø¹Ù„ÙŠØ©) Ø®ÙˆØ°Ø© - Ù…Ù„Ø§Ø¨Ø³ â€“ Ø­Ø°Ø§Ø¡",
    "Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙØ§Ø² Ø§Ù„Ù…Ø·Ø§Ø·ÙŠ (33000 â€“ 13000 â€“ 1000) Ùƒ.Ù.Ø£",
    "Ø§Ù„Ø®ÙˆØ°Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ù…Ø²ÙˆØ¯Ø© Ø¨Ø­Ø§Ù…Ù‰ ÙˆØ¬Ø©",
    "Ø£Ø­Ø²Ù…Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ù…Ø±Ù‚Ù…Ø© ÙˆØ³Ù„ÙŠÙ…Ø©"
];

let allReports = [];
if(sessionStorage.getItem('isAdmin')!=='true') location.href='trs.html';

function switchTab(t,b){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(bb=>bb.classList.remove('active'));
    document.getElementById(t).classList.add('active');
    b.classList.add('active');
    if(t==='inspectors') loadUsers();
}

async function fetchReports(){
    const res = await fetch(`${REDIS_URL}/lrange/reports_list/0/-1`,{headers:{Authorization:`Bearer ${REDIS_TOKEN}`}});
    const ids = (await res.json()).result||[];
    allReports=[];
    for(const id of ids){
        const r = await fetch(`${REDIS_URL}/get/report:${id}`,{headers:{Authorization:`Bearer ${REDIS_TOKEN}`}});
        const data = await r.json();
        if(data.result) allReports.push(JSON.parse(data.result));
    }
    allReports.reverse();
    renderReports();
}

function renderReports(){
    const term = document.getElementById('searchRep').value.toLowerCase();
    const list = document.getElementById('reportsList');
    list.innerHTML = "";
    const filtered = allReports.filter(r=>(r.inspector||"").toLowerCase().includes(term)||(r.serial||"").includes(term));
    
    if(!filtered.length){ list.innerHTML="<p style='text-align:center'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ±</p>"; return; }

    filtered.forEach(r=>{
        // ğŸ”´ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«: Ø¥Ø¸Ù‡Ø§Ø± Ø£ÙŠ Ø¨Ù†Ø¯ Ù„Ù‡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ùˆ ØµÙˆØ±Ø© Ø£Ùˆ Ø¥Ø¬Ø§Ø¨Ø© "Ù„Ø§"
        let violationsHtml = '';
        if(r.violations && r.violations.length > 0) {
            violationsHtml = `<div class="violations-box"><div class="v-title"><i class="fa-solid fa-triangle-exclamation"></i> Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø©:</div>`;
            r.violations.forEach(v => {
                const note = v.note ? `<div class="v-note">ğŸ“ ${v.note}</div>` : '';
                // Ø¥Ø¶Ø§ÙØ© onclick Ù„ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©
                const img = v.photo ? `<br><img src="${v.photo}" class="v-img" onclick="showImg('${v.photo}')">` : '';
                
                violationsHtml += `
                <div class="v-item">
                    <div style="font-weight:bold; font-size:13px; margin-bottom:5px;">ğŸ”¹ ${v.q}</div>
                    <span class="${v.ans==='Ù†Ø¹Ù…'?'val-yes':'val-no'}" style="padding:2px 8px; border-radius:10px; font-size:11px;">${v.ans}</span>
                    ${note}
                    ${img}
                </div>`;
            });
            violationsHtml += `</div>`;
        }

        list.innerHTML += `
        <div class="card">
            <div class="report-header">
                <div><div class="r-serial">#${r.serial}</div><div class="r-meta">${r.timestamp}</div></div>
                <div><div style="font-weight:bold; color:var(--main-blue)">${r.inspector}</div></div>
            </div>
            <div class="data-row">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: <b>${r.location}</b></div>
            <div class="data-row">ğŸ—ï¸ Ø§Ù„Ø¹Ù…Ù„: <b>${r.work_desc}</b></div>
            
            ${violationsHtml}

            <button class="eye-btn" onclick="toggleDetails(this, '${r.serial}')">
                <i class="fa-regular fa-eye"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù€ ${fullQuestionsList.length} Ø¨Ù†Ø¯
            </button>
            <div class="details-panel" id="panel-${r.serial}"></div>

            <div style="display:flex; gap:10px; margin-top:15px">
                <button onclick="delRep(${r.serial})" style="flex:1; background:#fee2e2; color:#b91c1c; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold;">Ø­Ø°Ù</button>
                <button onclick="printRep(${r.serial})" style="flex:1; background:#e0f2fe; color:#0369a1; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold;">Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
        </div>`;
    });
}

function toggleDetails(btn, serial){
    const p = document.getElementById(`panel-${serial}`);
    if(p.style.display==='block'){ p.style.display='none'; return; }
    const r = allReports.find(x=>x.serial==serial);
    let h = `<div style="padding:10px; border:1px solid #ddd; border-radius:8px; margin-bottom:10px; font-size:12px">
        <p>Ø§Ù„Ù…Ø´Ø±Ù: ${r.supervisor_name}</p><p>Ø§Ù„Ù…Ø³ØªÙ„Ù…: ${r.receiver_name}</p><p>Ø§Ù„Ø­ÙŠ: ${r.district}</p>
    </div>`;
    fullQuestionsList.forEach((q,i)=>{
        const ans = r.answers && r.answers[i+1] ? r.answers[i+1] : "N/A";
        h += `<div class="ans-row"><div style="flex:1">${q}</div><div class="q-val ${ans==='Ù†Ø¹Ù…'?'val-yes':ans==='Ù„Ø§'?'val-no':'val-na'}">${ans}</div></div>`;
    });
    p.innerHTML = h;
    p.style.display='block';
}

function showImg(src){
    document.getElementById('modalImg').src = src;
    document.getElementById('imgModal').style.display = 'flex';
}

async function loadUsers(){
    const list = document.getElementById('usersListContainer');
    list.innerHTML='ØªØ­Ù…ÙŠÙ„...';
    const keys = (await (await fetch(`${REDIS_URL}/keys/user:*`,{headers:{Authorization:`Bearer ${REDIS_TOKEN}`}})).json()).result||[];
    list.innerHTML='';
    for(const k of keys){
        if(k==='user:admin') continue;
        const n = k.split(':')[1];
        const p = (await (await fetch(`${REDIS_URL}/get/${k}`,{headers:{Authorization:`Bearer ${REDIS_TOKEN}`}})).json()).result;
        list.innerHTML += `
        <div class="inspector-row">
            <div><b>ğŸ‘¤ ${n}</b></div>
            <div style="display:flex; align-items:center; gap:10px">
                <input type="password" value="${p}" readonly style="border:none; background:none; width:60px" onclick="this.type='text'">
                <button onclick="delUser('${n}')" style="background:#fee2e2; color:red; border:none; padding:5px 10px; border-radius:5px; cursor:pointer">Ø­Ø°Ù</button>
            </div>
        </div>`;
    }
}

async function addInspector(){
    const n=newInspectorName.value, p=newInspectorPass.value;
    if(!n||!p) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    await fetch(`${REDIS_URL}/set/user:${n}`,{method:'POST',headers:{Authorization:`Bearer ${REDIS_TOKEN}`},body:p});
    alert('ØªÙ…'); loadUsers();
}

async function delUser(n){
    if(confirm('Ø­Ø°ÙØŸ')) await fetch(`${REDIS_URL}/del/user:${n}`,{method:'POST',headers:{Authorization:`Bearer ${REDIS_TOKEN}`}});
    loadUsers();
}

async function delRep(s){
    if(confirm('Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ')){
        await fetch(`${REDIS_URL}/del/report:${s}`,{method:'POST',headers:{Authorization:`Bearer ${REDIS_TOKEN}`}});
        await fetch(`${REDIS_URL}/lrem/reports_list/0/${s}`,{method:'POST',headers:{Authorization:`Bearer ${REDIS_TOKEN}`}});
        fetchReports();
    }
}

function printRep(s){
    const r = allReports.find(x=>x.serial==s);
    let rows = "";
    r.violations.forEach(v=>{ rows+=`<tr><td>${v.q}</td><td>${v.ans}</td><td>${v.note||''} ${v.photo?'(ØµÙˆØ±Ø©)':''}</td></tr>`; });
    const w = window.open('','','width=800,height=800');
    w.document.write(`<h2 style="text-align:center">ØªÙ‚Ø±ÙŠØ± #${s}</h2><table border="1" style="width:100%; direction:rtl; border-collapse:collapse"><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>${rows}</table><script>window.print()<\/script>`);
}

function logout(){ sessionStorage.clear(); location.href='trs.html'; }

fetchReports();
</script>
</body>
</html>
